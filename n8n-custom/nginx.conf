server {
    listen 5679;
    server_name _;

    # Proxy to n8n
    location / {
        proxy_pass http://n8n:5678;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_read_timeout 86400;
        proxy_buffering off;

        # Inject legal footer into HTML responses
        sub_filter '</body>' '<div id="n8n-legal-footer" style="position: fixed; bottom: 0; left: 0; right: 0; background: rgba(24, 24, 27, 0.95); padding: 10px; text-align: center; font-size: 12px; color: #a1a1aa; border-top: 1px solid #3f3f46; z-index: 99999;">This service uses AI for workflow automation. By using this service, you agree to our <a href="https://strali.solutions/impressum" target="_blank" style="color: #60a5fa; text-decoration: none;">Imprint</a> and <a href="https://strali.solutions/datenschutz" target="_blank" style="color: #60a5fa; text-decoration: none;">Privacy Policy</a>.</div></body>';
        sub_filter_once on;
        sub_filter_types text/html;
    }
}
